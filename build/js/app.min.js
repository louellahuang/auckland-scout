// Foursquare API Credentials - Tim
// const client_id = '&client_id=' + 'Q5PQQNTJS4UGM10I1RWODUVC4XS2PBULBDYZKFLAFECJ4ZIM';
// const client_secret = '&client_secret=' + '4TMTXMB4LL35O3GR1QXONNBAJ5OCGZUO5HLWAQQGSHHPZZV2';

// // Foursquare API Credentials - Nikita
// const client_id = '&client_id=' + '2F1JEBGBXWUCCK1VS5OZAFT2BELR15OCVOBRDEVCJFKQNDGM';
// const client_secret = '&client_secret=' + 'UIK2BOJFZ1OEZJRBIMW35SOGRB1LFETJVWICBAVBE4JJVCJP';

// // Foursquare API Credentials - Louella
const client_id = '&client_id=' + 'JSBCLUKSAG3BD0D1BOIRNAEMKWTQY0P401LJCYETQQXBS3W0';
const client_secret = '&client_secret=' + 'HSRPRSP1SQJWTG3NN2EOBPCASHO52SBOU4ZPFXOJPZYIL3DK';
// - by Tim
// Step 1 - Is the event listener which identifies event.target. See main.js - by Tim
// Step 2 - Link the html element to the foursquare category ID - by Tim
function identifyCategory(e) {
  // declare variables
  let chosenRadius = '0';
  let chosenCategory = '0';
  // simple conditional to match the DOM element to the api ID
  if (e.id == 'jsCatTrending') {
    // chosenRadius = '6000';
    extractNeededData(trending);

  } else if (e.id == 'jsCatParks') {
    chosenRadius = '2000';
    chosenCategory = '4bf58dd8d48988d163941735';
    createSearchRequestURI(chosenRadius, chosenCategory);

  } else if (e.id == 'jsCatBeaches') {
    chosenRadius = '2000';
    chosenCategory = '4bf58dd8d48988d1e2941735';
    createSearchRequestURI(chosenRadius, chosenCategory);

  } else if (e.id == 'jsCatLookouts') {
    chosenRadius = '2000';
    chosenCategory = '4bf58dd8d48988d165941735';
    createSearchRequestURI(chosenRadius, chosenCategory);
  }
}


// Step 3 - Create the search query request uri - by Tim
function createSearchRequestURI(rad, cat) {
  const baseURI = 'https://api.foursquare.com/v2/venues/search?v=20170901';

  const latlong = '&ll=' + currentUserLocStr;
  // This value will be a variable
  const radius = '&radius=' + rad;
  // This value will be a variable
  const categoryId = '&categoryId=' + cat;
  // Put all the pieces together
  // client_id and client_secret are variables located in auth.js
  const requestURI = baseURI + client_id + client_secret + latlong + radius + categoryId;
  // run next function
  makeSearchRequest(requestURI);
}


// Step 4 - Make the actual request - by Tim
function makeSearchRequest(uri) {
  fetch(uri)
    .then(function(response) {
      return response.json();
    })
    .then(function(myJson) {
      extractNeededData(myJson.response.venues);
      console.log(myJson.response);
    })
    .catch(function(error) {
      console.log(error);
    });
}


// Step 5 - Extract the data we are using from the json response - by Tim
function extractNeededData(data) {
  // declare empty array
  const venuesForMap = [];
  // Loop through json response
  data.forEach(venue => {
    // Push the name, ID, and latlng into an array to use for the map
    venuesForMap.push({
      name: venue.name,
      id: venue.id,
      latlng: 
        [
          venue.location.lat,
          venue.location.lng
        ]
    });
  });
  // Create the map with the data gathered. Function located in main.js
  createMap(venuesForMap);
}
// Identifiers - by Tim
// Every ID prefixed with 'js' is a DOM element
const jsCatDropdown = document.getElementById('jsCatDropdown');
const jsCatTrending = document.getElementById('jsCatTrending');
const jsCatParks = document.getElementById('jsCatParks');
const jsCatBeaches = document.getElementById('jsCatBeaches');
const jsCatLookouts = document.getElementById('jsCatLookouts');
// These need to be global variables in order to access them from different functions
let currentUserLoc = [-36.8977931, 174.7854973];
let currentUserLocStr = '';
let mymap;
let zoom = 0;


// Wait for dom to be fully loaded, then add event listeners and initialise map - Tim
document.addEventListener("DOMContentLoaded", () => {
  console.log("DOM ready!");
  // identify the event target
  jsCatDropdown.addEventListener('click', (e) => {
    identifyCategory(e.target);
  });
  // Load the empty map on page load
  createInitialMap();
});


// Detect screen width and change zoom accordingly - by Nikita
function detectScreenWidth() {
  if ($(window).width() < 768) {
    let zoom = 10;
    console.log('screen size is less than 768px');
    return zoom;
  } else {
    let zoom = 11;
    console.log('screen size is less than 768px');
    return zoom;
  };
}


// This is the map that gets loaded om page load
function createInitialMap() {
  // detect screen size
  let z = detectScreenWidth();
  // Map work by Nikita
  let center = [-36.8977931, 174.7854973];
  mymap = L.map('mapid').setView(center, z);
  // create actual map
  createMapPart(center);
  // run the function to detect users location
  mymap.locate({setView: true, maxZoom: 16});
  // plot marker on the map for users location
  mymap.on('locationfound', onLocationFound);
}


// This is the map that gets loaded after user has selected a category
function createMap(v) {
  // detect screen size
  let z = detectScreenWidth();
  // remove previously loaded map first
  if(mymap) {
    mymap.remove();
  }
  // Map work by Nikita
  let center = currentUserLoc;
  mymap = L.map('mapid').setView(center, z);
  // create actual map
  createMapPart(center);
  // run the function to detect users location
  mymap.locate({setView: true, maxZoom: z});
  // plot marker on the map for users location
  mymap.on('locationfound', onLocationFound);
  // nikita - putting markers on the map
  v.forEach(function (venue) {
    try {
      var serviceIcon = L.icon({
        iconUrl: '../build/img/pin.svg',
        iconSize: [72, 72],
        popupAnchor: [0, -36]
      });
      var marker = L.marker(venue.latlng, { icon: serviceIcon }).addTo(mymap);
      marker.bindPopup('<div>' + venue.name + '</div>' + '<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalCenter">' + 'Explore' + '</button>')

    } catch (error) {
      console.log(error);
    }
  });
   // Louella
   modal();
}


// This is the logic that creates the map. Since we have two similar functions I put this part in a separate function to keep it DRY - Tim
function createMapPart(center) {
  // Tiles
  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidGhhbHl4OTAiLCJhIjoiY2o2YjdrZHRlMWJmYjJybDd2cW1rYnVnNSJ9.j_DQLfixHfhioVjH6qmqkw', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'mapbox.streets',
    accessToken: 'pk.eyJ1IjoibmlraXRhaG9pbmVzIiwiYSI6ImNqc203cHN5NDEwaGg0OXBpYnE0aXhhZmYifQ.58l8dUZg4uiFn7BYnZCJFA'
  }).addTo(mymap);
  // Radius
  L.circle(center, {
      radius: 21500,
      color: 'salmon',
      weight: 1,
      fill: true
    }).addTo(mymap);
}


// this function detects users location - by Tim
function onLocationFound(e) {
  var radius = e.accuracy / 2;
  // add marker to map
  L.marker(e.latlng).addTo(mymap)
    // open popup with a message
    .bindPopup("You are within " + radius + " meters from this point").openPopup();
  // add circle around marker
  L.circle(e.latlng, radius).addTo(mymap);
  // set global variables
  currentUserLoc = [e.latlng.lat, e.latlng.lng]
  currentUserLocStr = currentUserLoc.toString();
}
// Work from Louella

const version = '?v=20170901';
const key = version + client_id + client_secret;
const venueId = '59a45921351e3d43b07028b5';
const venueUrl = 'https://api.foursquare.com/v2/venues/' + venueId;

// Modal identifiers
const jsPopUpButton = document.getElementById('#modalCenter');
const jsModalLongTitle = document.getElementById('jsModalLongTitle');
const jsVenueImg = document.getElementById('jsVenueImg');
const jsVenueDescription = document.getElementById('jsVenueDescription');
const jsVenueWebsite = document.getElementById('jsVenueWebsite');
const jsMiniMap = document.getElementById('jsMiniMap');
const jsDirections = document.getElementById('jsDirections');

// Load modal
function modal() {
    $('#modalCenter').on('shown.bs.modal', function () {
        //Add venue details through API call
        showVenueDetails();
    });
}

// const baseURL = 'https://api.foursquare.com/v2/venues/';
// let venueUrl = baseURL + this.venueid + key;

// // Step 3 - Create the search query request uri
// function createSearchRequestURI(rad, cat) {
//     const baseURI = 'https://api.foursquare.com/v2/venues/search?v=20170901';
//     // const client_id = '&client_id=' + 'Q5PQQNTJS4UGM10I1RWODUVC4XS2PBULBDYZKFLAFECJ4ZIM';
//     // const client_secret = '&client_secret=' + '4TMTXMB4LL35O3GR1QXONNBAJ5OCGZUO5HLWAQQGSHHPZZV2';
//     const latlong = '&ll=' + '-36.8786499,174.7602798';
//     // This value will be a variable
//     const radius = '&radius=' + rad;
//     // This value will be a variable
//     const categoryId = '&categoryId=' + cat;
//     // Put all the pieces together
//     const requestURI = baseURI + client_id + client_secret + latlong + radius + categoryId;

//     makeSearchRequest(requestURI);
// }






// // Step 4 - Make the actual request
// function makeSearchRequest(uri) {
//     fetch(uri)
//         .then(function (response) {
//             return response.json();
//         })
//         .then(function (myJson) {
//             extractNeededData(myJson.response.venues);
//             //console.log(myJson.response.venues);
//         })
//         .catch(function (error) {
//             // Code for handling errors
//             console.log(error);
//         });
// }







// function showVenueDetails(venueUrl) {


//     // Request for each venue data

//     $.ajax({

//         url: venueUrl,
//         dataType: 'jsonp',

//         success: function (res) {

//             // Expose data of VENUE we just CLICKED
//             console.log(res);

//             //For Each Venue

//             // Modal title
//             jsModalLongTitle.innerHTML(res.response.venue.name);

//             // Clear/reset modal body copy so it's empty, before we add new data
//             $('.modal-body').empty();
//             $('.modal-footer').empty();

//             // Venue description
//             if (res.response.venue.description !== undefined) {
//                 jsVenueDescription.innerHTML(res.response.venue.description);
//             }

//             //Construct modal image/
//             if (res.response.venue.photos.groups.length > 0) {
//                 var photoPrefix = res.response.venue.bestPhoto.prefix;
//                 var photoSuffix = res.response.venue.bestPhoto.suffix;
//                 jsVenueImg.src(photoPrefix + '100x100' + photoSuffix);
//             }

//             // Add Phone
//             if (res.response.venue.contact.phone !== undefined) {
//                 $('.modal-body').append('<p class="phone"><span class="bold">Phone:</span> ' + res.response.venue.contact.phone + '</p>');
//             }

//             // Add address
//             if (res.response.venue.location.address !== undefined) {
//                 jsVenueWebsite.innerHTML(res.response.venue.location.address + ', ' + res.response.venue.location.city)
//             }

//             // Insert Mini map with user location https://leafletjs.com/reference-1.0.0.html
//             // remove previously loaded map first
//             if (miniMap) {
//                 miniMap.remove();
//             }
//             let userLocation = [-36.8977931, 174.7854973];
//             let miniMap = L.map('jsMiniMap', {
//                 scrollWheelZoom: false
//             }).setView(userLocation, 17);
//             L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
//                 attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
//                 maxZoom: 18,
//                 id: 'mapbox.streets',
//                 accessToken: 'pk.eyJ1IjoibmlraXRhaG9pbmVzIiwiYSI6ImNqc203cHN5NDEwaGg0OXBpYnE0aXhhZmYifQ.58l8dUZg4uiFn7BYnZCJFA'
//             }).addTo(miniMap);

//             // Now toggle the Modal
//             $('#myModal').modal('show');

//         } // End Success

//     }); // END AJAX request for venue data
// }


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJhcHAubWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEZvdXJzcXVhcmUgQVBJIENyZWRlbnRpYWxzIC0gVGltXG4vLyBjb25zdCBjbGllbnRfaWQgPSAnJmNsaWVudF9pZD0nICsgJ1E1UFFRTlRKUzRVR00xMEkxUldPRFVWQzRYUzJQQlVMQkRZWktGTEFGRUNKNFpJTSc7XG4vLyBjb25zdCBjbGllbnRfc2VjcmV0ID0gJyZjbGllbnRfc2VjcmV0PScgKyAnNFRNVFhNQjRMTDM1TzNHUjFRWE9OTkJBSjVPQ0daVU81SExXQVFRR1NISFBaWlYyJztcblxuLy8gLy8gRm91cnNxdWFyZSBBUEkgQ3JlZGVudGlhbHMgLSBOaWtpdGFcbi8vIGNvbnN0IGNsaWVudF9pZCA9ICcmY2xpZW50X2lkPScgKyAnMkYxSkVCR0JYV1VDQ0sxVlM1T1pBRlQyQkVMUjE1T0NWT0JSREVWQ0pGS1FOREdNJztcbi8vIGNvbnN0IGNsaWVudF9zZWNyZXQgPSAnJmNsaWVudF9zZWNyZXQ9JyArICdVSUsyQk9KRloxT0VaSlJCSU1XMzVTT0dSQjFMRkVUSlZXSUNCQVZCRTRKSlZDSlAnO1xuXG4vLyAvLyBGb3Vyc3F1YXJlIEFQSSBDcmVkZW50aWFscyAtIExvdWVsbGFcbmNvbnN0IGNsaWVudF9pZCA9ICcmY2xpZW50X2lkPScgKyAnSlNCQ0xVS1NBRzNCRDBEMUJPSVJOQUVNS1dUUVkwUDQwMUxKQ1lFVFFRWEJTM1cwJztcbmNvbnN0IGNsaWVudF9zZWNyZXQgPSAnJmNsaWVudF9zZWNyZXQ9JyArICdIU1JQUlNQMVNRSldURzNOTjJFT0JQQ0FTSE81MlNCT1U0WlBGWE9KUFpZSUwzREsnO1xuLy8gLSBieSBUaW1cbi8vIFN0ZXAgMSAtIElzIHRoZSBldmVudCBsaXN0ZW5lciB3aGljaCBpZGVudGlmaWVzIGV2ZW50LnRhcmdldC4gU2VlIG1haW4uanMgLSBieSBUaW1cbi8vIFN0ZXAgMiAtIExpbmsgdGhlIGh0bWwgZWxlbWVudCB0byB0aGUgZm91cnNxdWFyZSBjYXRlZ29yeSBJRCAtIGJ5IFRpbVxuZnVuY3Rpb24gaWRlbnRpZnlDYXRlZ29yeShlKSB7XG4gIC8vIGRlY2xhcmUgdmFyaWFibGVzXG4gIGxldCBjaG9zZW5SYWRpdXMgPSAnMCc7XG4gIGxldCBjaG9zZW5DYXRlZ29yeSA9ICcwJztcbiAgLy8gc2ltcGxlIGNvbmRpdGlvbmFsIHRvIG1hdGNoIHRoZSBET00gZWxlbWVudCB0byB0aGUgYXBpIElEXG4gIGlmIChlLmlkID09ICdqc0NhdFRyZW5kaW5nJykge1xuICAgIC8vIGNob3NlblJhZGl1cyA9ICc2MDAwJztcbiAgICBleHRyYWN0TmVlZGVkRGF0YSh0cmVuZGluZyk7XG5cbiAgfSBlbHNlIGlmIChlLmlkID09ICdqc0NhdFBhcmtzJykge1xuICAgIGNob3NlblJhZGl1cyA9ICcyMDAwJztcbiAgICBjaG9zZW5DYXRlZ29yeSA9ICc0YmY1OGRkOGQ0ODk4OGQxNjM5NDE3MzUnO1xuICAgIGNyZWF0ZVNlYXJjaFJlcXVlc3RVUkkoY2hvc2VuUmFkaXVzLCBjaG9zZW5DYXRlZ29yeSk7XG5cbiAgfSBlbHNlIGlmIChlLmlkID09ICdqc0NhdEJlYWNoZXMnKSB7XG4gICAgY2hvc2VuUmFkaXVzID0gJzIwMDAnO1xuICAgIGNob3NlbkNhdGVnb3J5ID0gJzRiZjU4ZGQ4ZDQ4OTg4ZDFlMjk0MTczNSc7XG4gICAgY3JlYXRlU2VhcmNoUmVxdWVzdFVSSShjaG9zZW5SYWRpdXMsIGNob3NlbkNhdGVnb3J5KTtcblxuICB9IGVsc2UgaWYgKGUuaWQgPT0gJ2pzQ2F0TG9va291dHMnKSB7XG4gICAgY2hvc2VuUmFkaXVzID0gJzIwMDAnO1xuICAgIGNob3NlbkNhdGVnb3J5ID0gJzRiZjU4ZGQ4ZDQ4OTg4ZDE2NTk0MTczNSc7XG4gICAgY3JlYXRlU2VhcmNoUmVxdWVzdFVSSShjaG9zZW5SYWRpdXMsIGNob3NlbkNhdGVnb3J5KTtcbiAgfVxufVxuXG5cbi8vIFN0ZXAgMyAtIENyZWF0ZSB0aGUgc2VhcmNoIHF1ZXJ5IHJlcXVlc3QgdXJpIC0gYnkgVGltXG5mdW5jdGlvbiBjcmVhdGVTZWFyY2hSZXF1ZXN0VVJJKHJhZCwgY2F0KSB7XG4gIGNvbnN0IGJhc2VVUkkgPSAnaHR0cHM6Ly9hcGkuZm91cnNxdWFyZS5jb20vdjIvdmVudWVzL3NlYXJjaD92PTIwMTcwOTAxJztcblxuICBjb25zdCBsYXRsb25nID0gJyZsbD0nICsgY3VycmVudFVzZXJMb2NTdHI7XG4gIC8vIFRoaXMgdmFsdWUgd2lsbCBiZSBhIHZhcmlhYmxlXG4gIGNvbnN0IHJhZGl1cyA9ICcmcmFkaXVzPScgKyByYWQ7XG4gIC8vIFRoaXMgdmFsdWUgd2lsbCBiZSBhIHZhcmlhYmxlXG4gIGNvbnN0IGNhdGVnb3J5SWQgPSAnJmNhdGVnb3J5SWQ9JyArIGNhdDtcbiAgLy8gUHV0IGFsbCB0aGUgcGllY2VzIHRvZ2V0aGVyXG4gIC8vIGNsaWVudF9pZCBhbmQgY2xpZW50X3NlY3JldCBhcmUgdmFyaWFibGVzIGxvY2F0ZWQgaW4gYXV0aC5qc1xuICBjb25zdCByZXF1ZXN0VVJJID0gYmFzZVVSSSArIGNsaWVudF9pZCArIGNsaWVudF9zZWNyZXQgKyBsYXRsb25nICsgcmFkaXVzICsgY2F0ZWdvcnlJZDtcbiAgLy8gcnVuIG5leHQgZnVuY3Rpb25cbiAgbWFrZVNlYXJjaFJlcXVlc3QocmVxdWVzdFVSSSk7XG59XG5cblxuLy8gU3RlcCA0IC0gTWFrZSB0aGUgYWN0dWFsIHJlcXVlc3QgLSBieSBUaW1cbmZ1bmN0aW9uIG1ha2VTZWFyY2hSZXF1ZXN0KHVyaSkge1xuICBmZXRjaCh1cmkpXG4gICAgLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgfSlcbiAgICAudGhlbihmdW5jdGlvbihteUpzb24pIHtcbiAgICAgIGV4dHJhY3ROZWVkZWREYXRhKG15SnNvbi5yZXNwb25zZS52ZW51ZXMpO1xuICAgICAgY29uc29sZS5sb2cobXlKc29uLnJlc3BvbnNlKTtcbiAgICB9KVxuICAgIC5jYXRjaChmdW5jdGlvbihlcnJvcikge1xuICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgIH0pO1xufVxuXG5cbi8vIFN0ZXAgNSAtIEV4dHJhY3QgdGhlIGRhdGEgd2UgYXJlIHVzaW5nIGZyb20gdGhlIGpzb24gcmVzcG9uc2UgLSBieSBUaW1cbmZ1bmN0aW9uIGV4dHJhY3ROZWVkZWREYXRhKGRhdGEpIHtcbiAgLy8gZGVjbGFyZSBlbXB0eSBhcnJheVxuICBjb25zdCB2ZW51ZXNGb3JNYXAgPSBbXTtcbiAgLy8gTG9vcCB0aHJvdWdoIGpzb24gcmVzcG9uc2VcbiAgZGF0YS5mb3JFYWNoKHZlbnVlID0+IHtcbiAgICAvLyBQdXNoIHRoZSBuYW1lLCBJRCwgYW5kIGxhdGxuZyBpbnRvIGFuIGFycmF5IHRvIHVzZSBmb3IgdGhlIG1hcFxuICAgIHZlbnVlc0Zvck1hcC5wdXNoKHtcbiAgICAgIG5hbWU6IHZlbnVlLm5hbWUsXG4gICAgICBpZDogdmVudWUuaWQsXG4gICAgICBsYXRsbmc6IFxuICAgICAgICBbXG4gICAgICAgICAgdmVudWUubG9jYXRpb24ubGF0LFxuICAgICAgICAgIHZlbnVlLmxvY2F0aW9uLmxuZ1xuICAgICAgICBdXG4gICAgfSk7XG4gIH0pO1xuICAvLyBDcmVhdGUgdGhlIG1hcCB3aXRoIHRoZSBkYXRhIGdhdGhlcmVkLiBGdW5jdGlvbiBsb2NhdGVkIGluIG1haW4uanNcbiAgY3JlYXRlTWFwKHZlbnVlc0Zvck1hcCk7XG59XG4vLyBJZGVudGlmaWVycyAtIGJ5IFRpbVxuLy8gRXZlcnkgSUQgcHJlZml4ZWQgd2l0aCAnanMnIGlzIGEgRE9NIGVsZW1lbnRcbmNvbnN0IGpzQ2F0RHJvcGRvd24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanNDYXREcm9wZG93bicpO1xuY29uc3QganNDYXRUcmVuZGluZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqc0NhdFRyZW5kaW5nJyk7XG5jb25zdCBqc0NhdFBhcmtzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pzQ2F0UGFya3MnKTtcbmNvbnN0IGpzQ2F0QmVhY2hlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqc0NhdEJlYWNoZXMnKTtcbmNvbnN0IGpzQ2F0TG9va291dHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanNDYXRMb29rb3V0cycpO1xuLy8gVGhlc2UgbmVlZCB0byBiZSBnbG9iYWwgdmFyaWFibGVzIGluIG9yZGVyIHRvIGFjY2VzcyB0aGVtIGZyb20gZGlmZmVyZW50IGZ1bmN0aW9uc1xubGV0IGN1cnJlbnRVc2VyTG9jID0gWy0zNi44OTc3OTMxLCAxNzQuNzg1NDk3M107XG5sZXQgY3VycmVudFVzZXJMb2NTdHIgPSAnJztcbmxldCBteW1hcDtcbmxldCB6b29tID0gMDtcblxuXG4vLyBXYWl0IGZvciBkb20gdG8gYmUgZnVsbHkgbG9hZGVkLCB0aGVuIGFkZCBldmVudCBsaXN0ZW5lcnMgYW5kIGluaXRpYWxpc2UgbWFwIC0gVGltXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XG4gIGNvbnNvbGUubG9nKFwiRE9NIHJlYWR5IVwiKTtcbiAgLy8gaWRlbnRpZnkgdGhlIGV2ZW50IHRhcmdldFxuICBqc0NhdERyb3Bkb3duLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICBpZGVudGlmeUNhdGVnb3J5KGUudGFyZ2V0KTtcbiAgfSk7XG4gIC8vIExvYWQgdGhlIGVtcHR5IG1hcCBvbiBwYWdlIGxvYWRcbiAgY3JlYXRlSW5pdGlhbE1hcCgpO1xufSk7XG5cblxuLy8gRGV0ZWN0IHNjcmVlbiB3aWR0aCBhbmQgY2hhbmdlIHpvb20gYWNjb3JkaW5nbHkgLSBieSBOaWtpdGFcbmZ1bmN0aW9uIGRldGVjdFNjcmVlbldpZHRoKCkge1xuICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPCA3NjgpIHtcbiAgICBsZXQgem9vbSA9IDEwO1xuICAgIGNvbnNvbGUubG9nKCdzY3JlZW4gc2l6ZSBpcyBsZXNzIHRoYW4gNzY4cHgnKTtcbiAgICByZXR1cm4gem9vbTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgem9vbSA9IDExO1xuICAgIGNvbnNvbGUubG9nKCdzY3JlZW4gc2l6ZSBpcyBsZXNzIHRoYW4gNzY4cHgnKTtcbiAgICByZXR1cm4gem9vbTtcbiAgfTtcbn1cblxuXG4vLyBUaGlzIGlzIHRoZSBtYXAgdGhhdCBnZXRzIGxvYWRlZCBvbSBwYWdlIGxvYWRcbmZ1bmN0aW9uIGNyZWF0ZUluaXRpYWxNYXAoKSB7XG4gIC8vIGRldGVjdCBzY3JlZW4gc2l6ZVxuICBsZXQgeiA9IGRldGVjdFNjcmVlbldpZHRoKCk7XG4gIC8vIE1hcCB3b3JrIGJ5IE5pa2l0YVxuICBsZXQgY2VudGVyID0gWy0zNi44OTc3OTMxLCAxNzQuNzg1NDk3M107XG4gIG15bWFwID0gTC5tYXAoJ21hcGlkJykuc2V0VmlldyhjZW50ZXIsIHopO1xuICAvLyBjcmVhdGUgYWN0dWFsIG1hcFxuICBjcmVhdGVNYXBQYXJ0KGNlbnRlcik7XG4gIC8vIHJ1biB0aGUgZnVuY3Rpb24gdG8gZGV0ZWN0IHVzZXJzIGxvY2F0aW9uXG4gIG15bWFwLmxvY2F0ZSh7c2V0VmlldzogdHJ1ZSwgbWF4Wm9vbTogMTZ9KTtcbiAgLy8gcGxvdCBtYXJrZXIgb24gdGhlIG1hcCBmb3IgdXNlcnMgbG9jYXRpb25cbiAgbXltYXAub24oJ2xvY2F0aW9uZm91bmQnLCBvbkxvY2F0aW9uRm91bmQpO1xufVxuXG5cbi8vIFRoaXMgaXMgdGhlIG1hcCB0aGF0IGdldHMgbG9hZGVkIGFmdGVyIHVzZXIgaGFzIHNlbGVjdGVkIGEgY2F0ZWdvcnlcbmZ1bmN0aW9uIGNyZWF0ZU1hcCh2KSB7XG4gIC8vIGRldGVjdCBzY3JlZW4gc2l6ZVxuICBsZXQgeiA9IGRldGVjdFNjcmVlbldpZHRoKCk7XG4gIC8vIHJlbW92ZSBwcmV2aW91c2x5IGxvYWRlZCBtYXAgZmlyc3RcbiAgaWYobXltYXApIHtcbiAgICBteW1hcC5yZW1vdmUoKTtcbiAgfVxuICAvLyBNYXAgd29yayBieSBOaWtpdGFcbiAgbGV0IGNlbnRlciA9IGN1cnJlbnRVc2VyTG9jO1xuICBteW1hcCA9IEwubWFwKCdtYXBpZCcpLnNldFZpZXcoY2VudGVyLCB6KTtcbiAgLy8gY3JlYXRlIGFjdHVhbCBtYXBcbiAgY3JlYXRlTWFwUGFydChjZW50ZXIpO1xuICAvLyBydW4gdGhlIGZ1bmN0aW9uIHRvIGRldGVjdCB1c2VycyBsb2NhdGlvblxuICBteW1hcC5sb2NhdGUoe3NldFZpZXc6IHRydWUsIG1heFpvb206IHp9KTtcbiAgLy8gcGxvdCBtYXJrZXIgb24gdGhlIG1hcCBmb3IgdXNlcnMgbG9jYXRpb25cbiAgbXltYXAub24oJ2xvY2F0aW9uZm91bmQnLCBvbkxvY2F0aW9uRm91bmQpO1xuICAvLyBuaWtpdGEgLSBwdXR0aW5nIG1hcmtlcnMgb24gdGhlIG1hcFxuICB2LmZvckVhY2goZnVuY3Rpb24gKHZlbnVlKSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBzZXJ2aWNlSWNvbiA9IEwuaWNvbih7XG4gICAgICAgIGljb25Vcmw6ICcuLi9idWlsZC9pbWcvcGluLnN2ZycsXG4gICAgICAgIGljb25TaXplOiBbNzIsIDcyXSxcbiAgICAgICAgcG9wdXBBbmNob3I6IFswLCAtMzZdXG4gICAgICB9KTtcbiAgICAgIHZhciBtYXJrZXIgPSBMLm1hcmtlcih2ZW51ZS5sYXRsbmcsIHsgaWNvbjogc2VydmljZUljb24gfSkuYWRkVG8obXltYXApO1xuICAgICAgbWFya2VyLmJpbmRQb3B1cCgnPGRpdj4nICsgdmVudWUubmFtZSArICc8L2Rpdj4nICsgJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuIGJ0bi1wcmltYXJ5XCIgZGF0YS10b2dnbGU9XCJtb2RhbFwiIGRhdGEtdGFyZ2V0PVwiI21vZGFsQ2VudGVyXCI+JyArICdFeHBsb3JlJyArICc8L2J1dHRvbj4nKVxuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICB9XG4gIH0pO1xuICAgLy8gTG91ZWxsYVxuICAgbW9kYWwoKTtcbn1cblxuXG4vLyBUaGlzIGlzIHRoZSBsb2dpYyB0aGF0IGNyZWF0ZXMgdGhlIG1hcC4gU2luY2Ugd2UgaGF2ZSB0d28gc2ltaWxhciBmdW5jdGlvbnMgSSBwdXQgdGhpcyBwYXJ0IGluIGEgc2VwYXJhdGUgZnVuY3Rpb24gdG8ga2VlcCBpdCBEUlkgLSBUaW1cbmZ1bmN0aW9uIGNyZWF0ZU1hcFBhcnQoY2VudGVyKSB7XG4gIC8vIFRpbGVzXG4gIEwudGlsZUxheWVyKCdodHRwczovL2FwaS50aWxlcy5tYXBib3guY29tL3Y0L3tpZH0ve3p9L3t4fS97eX0ucG5nP2FjY2Vzc190b2tlbj1way5leUoxSWpvaWRHaGhiSGw0T1RBaUxDSmhJam9pWTJvMllqZHJaSFJsTVdKbVlqSnliRGQyY1cxclluVm5OU0o5LmpfRFFMZml4SGZoaW9Wakg2cW1xa3cnLCB7XG4gICAgYXR0cmlidXRpb246ICdNYXAgZGF0YSAmY29weTsgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL1wiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycywgPGEgaHJlZj1cImh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS8yLjAvXCI+Q0MtQlktU0E8L2E+LCBJbWFnZXJ5IMKpIDxhIGhyZWY9XCJodHRwczovL3d3dy5tYXBib3guY29tL1wiPk1hcGJveDwvYT4nLFxuICAgIG1heFpvb206IDE4LFxuICAgIGlkOiAnbWFwYm94LnN0cmVldHMnLFxuICAgIGFjY2Vzc1Rva2VuOiAncGsuZXlKMUlqb2libWxyYVhSaGFHOXBibVZ6SWl3aVlTSTZJbU5xYzIwM2NITjVOREV3YUdnME9YQnBZbkUwYVhoaFptWWlmUS41OGw4ZFVaZzR1aUZuN0JZblpDSkZBJ1xuICB9KS5hZGRUbyhteW1hcCk7XG4gIC8vIFJhZGl1c1xuICBMLmNpcmNsZShjZW50ZXIsIHtcbiAgICAgIHJhZGl1czogMjE1MDAsXG4gICAgICBjb2xvcjogJ3NhbG1vbicsXG4gICAgICB3ZWlnaHQ6IDEsXG4gICAgICBmaWxsOiB0cnVlXG4gICAgfSkuYWRkVG8obXltYXApO1xufVxuXG5cbi8vIHRoaXMgZnVuY3Rpb24gZGV0ZWN0cyB1c2VycyBsb2NhdGlvbiAtIGJ5IFRpbVxuZnVuY3Rpb24gb25Mb2NhdGlvbkZvdW5kKGUpIHtcbiAgdmFyIHJhZGl1cyA9IGUuYWNjdXJhY3kgLyAyO1xuICAvLyBhZGQgbWFya2VyIHRvIG1hcFxuICBMLm1hcmtlcihlLmxhdGxuZykuYWRkVG8obXltYXApXG4gICAgLy8gb3BlbiBwb3B1cCB3aXRoIGEgbWVzc2FnZVxuICAgIC5iaW5kUG9wdXAoXCJZb3UgYXJlIHdpdGhpbiBcIiArIHJhZGl1cyArIFwiIG1ldGVycyBmcm9tIHRoaXMgcG9pbnRcIikub3BlblBvcHVwKCk7XG4gIC8vIGFkZCBjaXJjbGUgYXJvdW5kIG1hcmtlclxuICBMLmNpcmNsZShlLmxhdGxuZywgcmFkaXVzKS5hZGRUbyhteW1hcCk7XG4gIC8vIHNldCBnbG9iYWwgdmFyaWFibGVzXG4gIGN1cnJlbnRVc2VyTG9jID0gW2UubGF0bG5nLmxhdCwgZS5sYXRsbmcubG5nXVxuICBjdXJyZW50VXNlckxvY1N0ciA9IGN1cnJlbnRVc2VyTG9jLnRvU3RyaW5nKCk7XG59XG4vLyBXb3JrIGZyb20gTG91ZWxsYVxuXG5jb25zdCB2ZXJzaW9uID0gJz92PTIwMTcwOTAxJztcbmNvbnN0IGtleSA9IHZlcnNpb24gKyBjbGllbnRfaWQgKyBjbGllbnRfc2VjcmV0O1xuY29uc3QgdmVudWVJZCA9ICc1OWE0NTkyMTM1MWUzZDQzYjA3MDI4YjUnO1xuY29uc3QgdmVudWVVcmwgPSAnaHR0cHM6Ly9hcGkuZm91cnNxdWFyZS5jb20vdjIvdmVudWVzLycgKyB2ZW51ZUlkO1xuXG4vLyBNb2RhbCBpZGVudGlmaWVyc1xuY29uc3QganNQb3BVcEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCcjbW9kYWxDZW50ZXInKTtcbmNvbnN0IGpzTW9kYWxMb25nVGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanNNb2RhbExvbmdUaXRsZScpO1xuY29uc3QganNWZW51ZUltZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqc1ZlbnVlSW1nJyk7XG5jb25zdCBqc1ZlbnVlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnanNWZW51ZURlc2NyaXB0aW9uJyk7XG5jb25zdCBqc1ZlbnVlV2Vic2l0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqc1ZlbnVlV2Vic2l0ZScpO1xuY29uc3QganNNaW5pTWFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pzTWluaU1hcCcpO1xuY29uc3QganNEaXJlY3Rpb25zID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2pzRGlyZWN0aW9ucycpO1xuXG4vLyBMb2FkIG1vZGFsXG5mdW5jdGlvbiBtb2RhbCgpIHtcbiAgICAkKCcjbW9kYWxDZW50ZXInKS5vbignc2hvd24uYnMubW9kYWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vQWRkIHZlbnVlIGRldGFpbHMgdGhyb3VnaCBBUEkgY2FsbFxuICAgICAgICBzaG93VmVudWVEZXRhaWxzKCk7XG4gICAgfSk7XG59XG5cbi8vIGNvbnN0IGJhc2VVUkwgPSAnaHR0cHM6Ly9hcGkuZm91cnNxdWFyZS5jb20vdjIvdmVudWVzLyc7XG4vLyBsZXQgdmVudWVVcmwgPSBiYXNlVVJMICsgdGhpcy52ZW51ZWlkICsga2V5O1xuXG4vLyAvLyBTdGVwIDMgLSBDcmVhdGUgdGhlIHNlYXJjaCBxdWVyeSByZXF1ZXN0IHVyaVxuLy8gZnVuY3Rpb24gY3JlYXRlU2VhcmNoUmVxdWVzdFVSSShyYWQsIGNhdCkge1xuLy8gICAgIGNvbnN0IGJhc2VVUkkgPSAnaHR0cHM6Ly9hcGkuZm91cnNxdWFyZS5jb20vdjIvdmVudWVzL3NlYXJjaD92PTIwMTcwOTAxJztcbi8vICAgICAvLyBjb25zdCBjbGllbnRfaWQgPSAnJmNsaWVudF9pZD0nICsgJ1E1UFFRTlRKUzRVR00xMEkxUldPRFVWQzRYUzJQQlVMQkRZWktGTEFGRUNKNFpJTSc7XG4vLyAgICAgLy8gY29uc3QgY2xpZW50X3NlY3JldCA9ICcmY2xpZW50X3NlY3JldD0nICsgJzRUTVRYTUI0TEwzNU8zR1IxUVhPTk5CQUo1T0NHWlVPNUhMV0FRUUdTSEhQWlpWMic7XG4vLyAgICAgY29uc3QgbGF0bG9uZyA9ICcmbGw9JyArICctMzYuODc4NjQ5OSwxNzQuNzYwMjc5OCc7XG4vLyAgICAgLy8gVGhpcyB2YWx1ZSB3aWxsIGJlIGEgdmFyaWFibGVcbi8vICAgICBjb25zdCByYWRpdXMgPSAnJnJhZGl1cz0nICsgcmFkO1xuLy8gICAgIC8vIFRoaXMgdmFsdWUgd2lsbCBiZSBhIHZhcmlhYmxlXG4vLyAgICAgY29uc3QgY2F0ZWdvcnlJZCA9ICcmY2F0ZWdvcnlJZD0nICsgY2F0O1xuLy8gICAgIC8vIFB1dCBhbGwgdGhlIHBpZWNlcyB0b2dldGhlclxuLy8gICAgIGNvbnN0IHJlcXVlc3RVUkkgPSBiYXNlVVJJICsgY2xpZW50X2lkICsgY2xpZW50X3NlY3JldCArIGxhdGxvbmcgKyByYWRpdXMgKyBjYXRlZ29yeUlkO1xuXG4vLyAgICAgbWFrZVNlYXJjaFJlcXVlc3QocmVxdWVzdFVSSSk7XG4vLyB9XG5cblxuXG5cblxuXG4vLyAvLyBTdGVwIDQgLSBNYWtlIHRoZSBhY3R1YWwgcmVxdWVzdFxuLy8gZnVuY3Rpb24gbWFrZVNlYXJjaFJlcXVlc3QodXJpKSB7XG4vLyAgICAgZmV0Y2godXJpKVxuLy8gICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbi8vICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4vLyAgICAgICAgIH0pXG4vLyAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChteUpzb24pIHtcbi8vICAgICAgICAgICAgIGV4dHJhY3ROZWVkZWREYXRhKG15SnNvbi5yZXNwb25zZS52ZW51ZXMpO1xuLy8gICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhteUpzb24ucmVzcG9uc2UudmVudWVzKTtcbi8vICAgICAgICAgfSlcbi8vICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuLy8gICAgICAgICAgICAgLy8gQ29kZSBmb3IgaGFuZGxpbmcgZXJyb3JzXG4vLyAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4vLyAgICAgICAgIH0pO1xuLy8gfVxuXG5cblxuXG5cblxuXG4vLyBmdW5jdGlvbiBzaG93VmVudWVEZXRhaWxzKHZlbnVlVXJsKSB7XG5cblxuLy8gICAgIC8vIFJlcXVlc3QgZm9yIGVhY2ggdmVudWUgZGF0YVxuXG4vLyAgICAgJC5hamF4KHtcblxuLy8gICAgICAgICB1cmw6IHZlbnVlVXJsLFxuLy8gICAgICAgICBkYXRhVHlwZTogJ2pzb25wJyxcblxuLy8gICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzKSB7XG5cbi8vICAgICAgICAgICAgIC8vIEV4cG9zZSBkYXRhIG9mIFZFTlVFIHdlIGp1c3QgQ0xJQ0tFRFxuLy8gICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcblxuLy8gICAgICAgICAgICAgLy9Gb3IgRWFjaCBWZW51ZVxuXG4vLyAgICAgICAgICAgICAvLyBNb2RhbCB0aXRsZVxuLy8gICAgICAgICAgICAganNNb2RhbExvbmdUaXRsZS5pbm5lckhUTUwocmVzLnJlc3BvbnNlLnZlbnVlLm5hbWUpO1xuXG4vLyAgICAgICAgICAgICAvLyBDbGVhci9yZXNldCBtb2RhbCBib2R5IGNvcHkgc28gaXQncyBlbXB0eSwgYmVmb3JlIHdlIGFkZCBuZXcgZGF0YVxuLy8gICAgICAgICAgICAgJCgnLm1vZGFsLWJvZHknKS5lbXB0eSgpO1xuLy8gICAgICAgICAgICAgJCgnLm1vZGFsLWZvb3RlcicpLmVtcHR5KCk7XG5cbi8vICAgICAgICAgICAgIC8vIFZlbnVlIGRlc2NyaXB0aW9uXG4vLyAgICAgICAgICAgICBpZiAocmVzLnJlc3BvbnNlLnZlbnVlLmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpIHtcbi8vICAgICAgICAgICAgICAgICBqc1ZlbnVlRGVzY3JpcHRpb24uaW5uZXJIVE1MKHJlcy5yZXNwb25zZS52ZW51ZS5kZXNjcmlwdGlvbik7XG4vLyAgICAgICAgICAgICB9XG5cbi8vICAgICAgICAgICAgIC8vQ29uc3RydWN0IG1vZGFsIGltYWdlL1xuLy8gICAgICAgICAgICAgaWYgKHJlcy5yZXNwb25zZS52ZW51ZS5waG90b3MuZ3JvdXBzLmxlbmd0aCA+IDApIHtcbi8vICAgICAgICAgICAgICAgICB2YXIgcGhvdG9QcmVmaXggPSByZXMucmVzcG9uc2UudmVudWUuYmVzdFBob3RvLnByZWZpeDtcbi8vICAgICAgICAgICAgICAgICB2YXIgcGhvdG9TdWZmaXggPSByZXMucmVzcG9uc2UudmVudWUuYmVzdFBob3RvLnN1ZmZpeDtcbi8vICAgICAgICAgICAgICAgICBqc1ZlbnVlSW1nLnNyYyhwaG90b1ByZWZpeCArICcxMDB4MTAwJyArIHBob3RvU3VmZml4KTtcbi8vICAgICAgICAgICAgIH1cblxuLy8gICAgICAgICAgICAgLy8gQWRkIFBob25lXG4vLyAgICAgICAgICAgICBpZiAocmVzLnJlc3BvbnNlLnZlbnVlLmNvbnRhY3QucGhvbmUgIT09IHVuZGVmaW5lZCkge1xuLy8gICAgICAgICAgICAgICAgICQoJy5tb2RhbC1ib2R5JykuYXBwZW5kKCc8cCBjbGFzcz1cInBob25lXCI+PHNwYW4gY2xhc3M9XCJib2xkXCI+UGhvbmU6PC9zcGFuPiAnICsgcmVzLnJlc3BvbnNlLnZlbnVlLmNvbnRhY3QucGhvbmUgKyAnPC9wPicpO1xuLy8gICAgICAgICAgICAgfVxuXG4vLyAgICAgICAgICAgICAvLyBBZGQgYWRkcmVzc1xuLy8gICAgICAgICAgICAgaWYgKHJlcy5yZXNwb25zZS52ZW51ZS5sb2NhdGlvbi5hZGRyZXNzICE9PSB1bmRlZmluZWQpIHtcbi8vICAgICAgICAgICAgICAgICBqc1ZlbnVlV2Vic2l0ZS5pbm5lckhUTUwocmVzLnJlc3BvbnNlLnZlbnVlLmxvY2F0aW9uLmFkZHJlc3MgKyAnLCAnICsgcmVzLnJlc3BvbnNlLnZlbnVlLmxvY2F0aW9uLmNpdHkpXG4vLyAgICAgICAgICAgICB9XG5cbi8vICAgICAgICAgICAgIC8vIEluc2VydCBNaW5pIG1hcCB3aXRoIHVzZXIgbG9jYXRpb24gaHR0cHM6Ly9sZWFmbGV0anMuY29tL3JlZmVyZW5jZS0xLjAuMC5odG1sXG4vLyAgICAgICAgICAgICAvLyByZW1vdmUgcHJldmlvdXNseSBsb2FkZWQgbWFwIGZpcnN0XG4vLyAgICAgICAgICAgICBpZiAobWluaU1hcCkge1xuLy8gICAgICAgICAgICAgICAgIG1pbmlNYXAucmVtb3ZlKCk7XG4vLyAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICBsZXQgdXNlckxvY2F0aW9uID0gWy0zNi44OTc3OTMxLCAxNzQuNzg1NDk3M107XG4vLyAgICAgICAgICAgICBsZXQgbWluaU1hcCA9IEwubWFwKCdqc01pbmlNYXAnLCB7XG4vLyAgICAgICAgICAgICAgICAgc2Nyb2xsV2hlZWxab29tOiBmYWxzZVxuLy8gICAgICAgICAgICAgfSkuc2V0Vmlldyh1c2VyTG9jYXRpb24sIDE3KTtcbi8vICAgICAgICAgICAgIEwudGlsZUxheWVyKCdodHRwczovL2FwaS50aWxlcy5tYXBib3guY29tL3Y0L3tpZH0ve3p9L3t4fS97eX0ucG5nP2FjY2Vzc190b2tlbj17YWNjZXNzVG9rZW59Jywge1xuLy8gICAgICAgICAgICAgICAgIGF0dHJpYnV0aW9uOiAnTWFwIGRhdGEgJmNvcHk7IDxhIGhyZWY9XCJodHRwczovL3d3dy5vcGVuc3RyZWV0bWFwLm9yZy9cIj5PcGVuU3RyZWV0TWFwPC9hPiBjb250cmlidXRvcnMsIDxhIGhyZWY9XCJodHRwczovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvYnktc2EvMi4wL1wiPkNDLUJZLVNBPC9hPiwgSW1hZ2VyeSDCqSA8YSBocmVmPVwiaHR0cHM6Ly93d3cubWFwYm94LmNvbS9cIj5NYXBib3g8L2E+Jyxcbi8vICAgICAgICAgICAgICAgICBtYXhab29tOiAxOCxcbi8vICAgICAgICAgICAgICAgICBpZDogJ21hcGJveC5zdHJlZXRzJyxcbi8vICAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbjogJ3BrLmV5SjFJam9pYm1scmFYUmhhRzlwYm1Weklpd2lZU0k2SW1OcWMyMDNjSE41TkRFd2FHZzBPWEJwWW5FMGFYaGhabVlpZlEuNThsOGRVWmc0dWlGbjdCWW5aQ0pGQSdcbi8vICAgICAgICAgICAgIH0pLmFkZFRvKG1pbmlNYXApO1xuXG4vLyAgICAgICAgICAgICAvLyBOb3cgdG9nZ2xlIHRoZSBNb2RhbFxuLy8gICAgICAgICAgICAgJCgnI215TW9kYWwnKS5tb2RhbCgnc2hvdycpO1xuXG4vLyAgICAgICAgIH0gLy8gRW5kIFN1Y2Nlc3NcblxuLy8gICAgIH0pOyAvLyBFTkQgQUpBWCByZXF1ZXN0IGZvciB2ZW51ZSBkYXRhXG4vLyB9XG5cbiJdLCJmaWxlIjoiYXBwLm1pbi5qcyJ9
